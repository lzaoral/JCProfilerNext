


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Measurements - example.Example#example(javacard.framework.APDU)</title>
        <link rel="stylesheet"
          href="https://fonts.googleapis.com/css?family=Open+Sans">
        <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.3/highlight.min.js"></script>
    <script>hljs.highlightAll()</script>
    <script src="https://cdn.plot.ly/plotly-2.16.1.min.js"></script>
    <style>


.contents {
    display: flex;
    justify-content: space-between;
}

.modebar-container {
    z-index: 2;
}

.main-svg {
    z-index: 1;
}

.trap {
    position: relative;
}

.trap:hover {
    cursor: pointer;
    font-style: italic;
}

.trap_select {
    background-color: rgba(0, 255, 255, 25%);
    font-style: italic;
}

.trap_err {
    background-color: rgba(255, 0, 0, 25%);
}

.trap_warn {
    background-color: rgba(255, 255, 0, 50%);
}

.trapSwitch {
    bottom: 0;
    position: absolute;
    right: 0;
}

.notes  {
    align-items: center;
    background-color: rgba(248, 248, 248, 0.97);
    display: flex;
    justify-content: space-between;
    padding: 0.5em;
}

.note {
    align-items: center;
    display: flex;
    justify-content: left;
}

.square {
    display: inline-block;
    height: 20px;
    margin-right: 10px;
    width: 20px;
}

.graph {
    align-content: center;
    width: 49%;
}

.graph-sticky {
    top: 0;
    position: -webkit-sticky;
    position: sticky;
}

.code {
    float: left;
    width: 50%;
}

pre {
    /* override the default pre margin in Firefox and Chrome */
    margin-bottom: 0;
}

#codeWithTraps, #codeWithoutTraps {
    flex: 1;
    margin-left: -100px;
    overflow-x: auto;
}

#codeWithTraps, #graphHelp {
    display: none;
}

.codeHeader {
    position: relative;
    margin-bottom: 20px;
    word-wrap: anywhere;
}

.codeContainer {
    display: flex;
    justify-content: flex-start;
}

.codeWrapper {
    display: inline-block;
    min-width: 100%;
}

.center {
    text-align: center;
}
    </style>
</head>
<body>
    <h1>example.Example#example(javacard.framework.APDU)</h1>
    <h3 id="graphName" class="center"></h3>
    <div class="contents">
        <div class="code">
            <div class="codeHeader">
                <div>
                    <b>Mode:</b> time<br>
                    <b>Card ATR:</b>                         <a href="https://smartcard-atr.apdu.fr/parse?ATR=3B80800101" target="_blank">3B80800101</a>
<br>
                        <b>Number of rounds:</b> 100<br>
                    <b>APDU header:</b> 00EE0000<br>
                        <b>Input regex:</b>
00[0-9A-F]{2}<br>
                        <b>Input division:</b> none<br>
                    <b>Elapsed time:</b> 0 days 00:11:19.224<br>
                    <b>Source measurements:</b> <a href="example-time.csv" target="_blank">measurements.csv</a>
                </div>
                <div class="trapSwitch">
                    <input type="checkbox" id="trapSwitch" autocomplete="off"/>
                    <label for="trapSwitch">Show explicit traps</label>
                </div>
            </div>
            <div class="codeContainer">
<div id="heatmap"></div>                <div id="codeWithTraps">
                    <div class="codeWrapper">
                        <pre><code class="language-java">private void example(APDU apdu) {
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1 trap">    <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1);</span>
</div>    short count = Util.getShort(apdu.getBuffer(), ISO7816.OFFSET_CDATA);
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2 trap">    <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2);</span>
</div>    for (short i = 0; i &lt; count; i++) {
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3 trap">        <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3);</span>
</div>        short tmp = 0;
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4 trap">        <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4);</span>
</div>        for (short k = 0; k &lt; 50; k++) {
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5 trap">            <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5);</span>
</div>            tmp++;
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6 trap">            <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6);</span>
</div>        }
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7 trap">        <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7);</span>
</div>    }
<div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8 trap">    <span class="trap_contents">PM.check(PMC.TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8);</span>
</div>}
</code></pre>
                    </div>
                </div>
                <div id="codeWithoutTraps">
                    <div class="codeWrapper">
                                                                        <pre><code class="language-java"><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1 trap"><span class="trap_contents">private void example(APDU apdu) {</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2 trap">    <span class="trap_contents">short count = Util.getShort(apdu.getBuffer(), ISO7816.OFFSET_CDATA);</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3 trap">    <span class="trap_contents">for (short i = 0; i &lt; count; i++) {</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4 trap">        <span class="trap_contents">short tmp = 0;</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5 trap">        <span class="trap_contents">for (short k = 0; k &lt; 50; k++) {</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6 trap">            <span class="trap_contents">tmp++;</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7 trap">        <span class="trap_contents">}</span>
</div><div class="TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8 trap">    <span class="trap_contents">}</span>
</div>}
</code></pre>
                    </div>
                </div>
            </div>
            <div>
                <h3 class="center">Colour explanation</h3>
                <div class="notes">
                    <div class="note">
                        <div class="square trap_select"></div>
                        Currently selected trap
                    </div>
                    <div class="note">
                        <div class="square trap_warn"></div>
                        Trap was never reached
                    </div>
                    <div class="note">
                        <div class="square trap_err"></div>
                        Trap was reached only sometimes
                    </div>
                </div>
            </div>
        </div>
        <div class="graph">
            <div class="graph-sticky">
                <div id="graphHelp" class="center">
                    <p>Click on a graph item to get a list of corresponding inputs.</p>
                </div>
                <div id="plotly"></div>
            </div>
        </div>
    </div>
    <script type="application/javascript">


const heatmapX = [
    'Avg μs',
];
const heatmapData  = {
    colorscale: 'RdBu'
};


/*
 * MACROS
 */


/*
 * CONSTANTS
 */

const trapPrefix = 'TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_';

const inputs = ['0063', '00CD', '0068', '006C', '0098', '0096', '0073', '0078', '00D2', '0075', '0040', '0081', '00F6', '00B8', '008B', '00D4', '00DB', '0073', '0009', '0057', '004D', '002D', '0095', '004F', '00FD', '0038', '0042', '00F0', '003D', '0015', '0045', '0066', '00FC', '00CD', '0083', '008C', '0087', '0089', '00FE', '002C', '0059', '00D8', '00F1', '00AE', '0093', '0066', '00A1', '00FC', '004D', '00E7', '0055', '0029', '001A', '00A8', '00B2', '00D6', '0019', '0005', '0076', '00F4', '0094', '0020', '007C', '00A4', '00A7', '0083', '0037', '0047', '0042', '0062', '0028', '0032', '0054', '00E9', '002B', '00E6', '0089', '006B', '0043', '00EC', '00AE', '00E0', '0087', '00A4', '001C', '00E9', '009C', '00C0', '0008', '00E0', '00B2', '0075', '006F', '00E8', '0061', '00C7', '001D', '00AC', '00F6', '002D'];
const measurements = {
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1: [92148, 92118, 92445, 92331, 92041, 92008, 92640, 91515, 91413, 92135, 92134, 91993, 92040, 91804, 92401, 91970, 92030, 91835, 91925, 91932, 92136, 91633, 91378, 91949, 91995, 91905, 91846, 91622, 91916, 91656, 91329, 91481, 91970, 91367, 91689, 92038, 92050, 91671, 91717, 91720, 91791, 91390, 91873, 91723, 92009, 91769, 92025, 91857, 91590, 91764, 91811, 91754, 91777, 91816, 91528, 91779, 91817, 91862, 91792, 91954, 91488, 91381, 91293, 91706, 91772, 91960, 91860, 91530, 91747, 91821, 91810, 91783, 91845, 91817, 91802, 91733, 91675, 91589, 91288, 91785, 91932, 91694, 91910, 91563, 91540, 91639, 91298, 91655, 91651, 91638, 91612, 91741, 91524, 91346, 92130, 91571, 91757, 91642, 91799, 91754],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2: [110, 455, 152, 186, 567, 749, -170, 100, 306, 301, 132, -23, 129, 488, 683, 137, 176, 428, 305, 288, 55, 280, 253, -15, 167, 288, 324, 333, 192, 522, 271, 374, -365, 228, -142, -203, 17, 371, -59, 301, -41, 467, 216, 554, -118, 220, -3, 209, 57, 312, 684, 364, 305, 66, 511, 220, 161, 80, 46, -293, 575, 392, 366, 281, 332, 475, 173, 495, 281, 808, -53, 367, -230, 285, 163, 159, -65, -17, 273, 107, 323, -25, 428, 577, 584, 587, 301, 90, 296, -75, 899, 123, 409, 599, -36, 266, 341, 458, 324, 275],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3: [429, -92, -681, 77, 393, -254, -58, 133, 684, -18, -211, 385, 360, 129, -665, 309, 70, -9, -214, -124, -102, 135, 233, 568, 43, 445, 436, -241, 19, -162, 165, 178, 296, 345, 168, -91, -66, 125, -20, 302, 295, 563, 200, -107, 122, 412, 0, -191, 257, 362, -376, -292, 124, 188, 40, 105, -7, -9, -156, 402, 143, 2, 54, 354, -164, -748, 195, 184, 266, -361, 388, -67, 764, 56, -53, 197, 385, 550, 101, -48, -74, 322, -296, -33, -296, 350, 65, 476, 64, 550, -370, 564, 54, 334, 233, 353, 102, 396, -50, -11],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4: [14, 278, 826, 192, -732, 335, 253, 42, -100, 63, 813, -234, -48, -106, 34, -116, 260, 180, 32, 366, 259, 216, 17, -311, 277, -178, -489, 84, 226, 304, 337, -10, 120, -124, 170, 158, 278, -256, 583, -48, 205, -23, -88, -147, 28, 96, 3, 355, 332, -209, 64, 531, -9, -324, 297, 117, 128, 471, 17, 518, 26, 70, -6, -278, 152, 708, 25, 260, 2, 0, 198, 297, -93, 299, 635, 92, 731, 248, 102, 333, -39, -23, 102, 167, 52, -320, 95, -139, 144, -171, 106, -381, 252, -114, 184, -27, -156, -93, 351, 319],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5: [11, -709, -404, 35, 430, -94, -305, 351, -36, 52, -367, 603, 375, 325, 283, 342, -242, 1, 423, -459, 159, 43, 77, 339, 389, -122, 616, 185, 158, 305, 41, -83, 326, 344, 105, -35, -371, 365, -165, 187, -134, -167, 3, 264, 343, -90, 378, -304, -42, 165, 72, -173, 150, 183, 34, 138, 250, -118, 362, -30, 182, 74, 204, 58, 514, -61, 1, -71, 147, 123, 70, 123, -214, 0, 60, 233, -160, 295, 36, 44, 23, 229, 206, 89, 239, 78, 308, 305, 159, 392, -35, 80, -17, 138, -257, 325, 259, -13, -303, -137],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6: [823, 156, 561, 270, 318, 305, 519, -124, 493, 168, 40, 44, -206, -24, 189, -7, -135, -55, 180, 601, 223, 293, -12, -115, -429, 323, -263, 521, -67, -18, -78, 504, 174, -49, 69, 143, 93, 82, -32, 37, 203, 215, 134, 289, 213, -90, 107, 406, 72, 142, 225, 42, -65, 22, -4, 233, 94, -198, 331, 188, -57, 90, 133, 323, -16, 247, 161, 101, -11, -66, 129, 107, 212, -98, -210, -5, -210, -74, 166, 283, 200, 169, -178, 123, -39, -250, -43, -242, -112, -41, 458, 234, -216, 275, 146, 154, 277, -205, 384, 289],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7: [9338, 10047, 9691, 9708, 10149, 9559, 10303, 10226, 10107, 9991, 10502, 9707, 10229, 10174, 9962, 10483, 10494, 10506, 9839, 10069, 9999, 9685, 10266, 10740, 10282, 9962, 10274, 10067, 10229, 10144, 10156, 10092, 10401, 10183, 9970, 10303, 10095, 10260, 10226, 9820, 10380, 9971, 10262, 9961, 9968, 10423, 10209, 10343, 10128, 10163, 10033, 9874, 10375, 10200, 9931, 9941, 10164, 10525, 10209, 9834, 10157, 10170, 10465, 10183, 9943, 10246, 10781, 10128, 10246, 10266, 9828, 10014, 10409, 9987, 9879, 9725, 10280, 9882, 10056, 10248, 10245, 9885, 10403, 9944, 10290, 9981, 10257, 10386, 10109, 9841, 9909, 9951, 10751, 10159, 10338, 9725, 9951, 10414, 10168, 10135],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8: [3947622, 8150691, 4086361, 4299643, 6048692, 5942925, 4543790, 4768932, 8374429, 4651736, 2549676, 5121110, 9782905, 7328961, 5483418, 8395288, 8726867, 4544296, 342124, 3392440, 3029814, 1749234, 5930894, 3135654, 10026353, 2207986, 2570463, 9546525, 2431918, 810463, 2688189, 4064028, 10015374, 8149682, 5227229, 5578855, 5354943, 5461250, 10122966, 1739327, 3498592, 8608449, 9557305, 6879946, 5824012, 4064376, 6400283, 10016333, 3029824, 9195589, 3371085, 1621963, 1034849, 6646169, 7094495, 8502150, 938768, 128196, 4661862, 9675774, 5835272, 1269647, 4896519, 6517799, 6634973, 5226915, 2197185, 2794844, 2570851, 3851004, 1525706, 1973671, 3274856, 9302814, 1643024, 9185852, 5461678, 4202730, 2667277, 9419475, 6880738, 8864750, 5355417, 6518063, 1056320, 9302543, 6176628, 7584103, 245168, 8864977, 7094231, 4651481, 4416271, 9205740, 3840769, 7916269, 1152504, 6859612, 9782828, 1749643]
};

const heatmapValues = {
    x: heatmapX,
    y: [...Array(17 + 1).keys()].splice(1).reverse(),
    z: [[null], [5290432.2], [null], [10136.66], [null], [99.38], [null], [92.9], [null], [112.82], [null], [102.82], [null], [246.19], [null], [91778.26], [null]]
};

const heatmapValuesFiltered = {
    x: heatmapValues.x,
    y: undefined,
    z: heatmapValues.z.filter((e, i, z) => i === 0 || z[i][0] !== null || z[i - 1][0] === null)
};
heatmapValuesFiltered.y = heatmapValues.y.slice(17 - heatmapValuesFiltered.z.length, 17);

const histogramCommon = {
    bingroup: '1',
    type: 'histogram',
    xaxis: 'x2',
    yaxis: 'y1',
    showlegend: true,
    hovertemplate: 'Trace: %{meta[0]}<br>Bin: %{x}<br>Count: %{y}<extra></extra>'
};

const configCommon = {
    displaylogo: false,
    responsive: true,
    toImageButtonOptions: {
        format: 'svg',
        scale: 2
    }
};

/*
 * FUNCTIONS
 */

// this is not very nice but Google didn't help much, nor I'm a JS developer ¯\_(ツ)_/¯
let heatmapHeight;
window.addEventListener('load', _ => {
    heatmapHeight = document.querySelector('#codeWithoutTraps code').clientHeight + 6;
    const maxLineStringSize = 2 * heatmapValues.y[0].toString().length;

    // Heatmap
    Plotly.newPlot('heatmap', [{
        ...heatmapValuesFiltered,
        hovertemplate: 'Line: %{y}<br>%{z} μs<extra></extra>',
        showlegend: false,
        showscale: false,
        type: 'heatmap',
        xgap: 4,
        ...heatmapData
    }], {
        paper_bgcolor: 'rgba(0, 0, 0, 0)',
        margin: {
            l: 18 + maxLineStringSize,
            r: 110,
            b: 0,
            t: 18,
            pad: 4
        },
        height: heatmapHeight,
        width: 112 + 45 * heatmapValues.x.length + maxLineStringSize,
        xaxis: {
            side: 'top',
            fixedrange: true,
            ticks: '',
            showgrid: false,
            zeroline: false
        },
        yaxis: {
            fixedrange: true,
            ticks: '',
            title: '',
            type: 'category',
            showgrid: false,
            zeroline: false
        }
    }, {
        displayModeBar: false
    });

    // Heatmap click event handler
    const heatmapDiv = document.getElementById('heatmap');
    heatmapDiv.on('plotly_click', function (data) {
        const graph = data.points[0];
        // check for a valid value
        if (graph.z === null)
            return;

        // compute the correct trap index
        const z = graph.data.z;

        let trapIdx = 0;
        for (let i = z.length - 1; i >= z.length - graph.y; i--) {
            if (z[i][0] !== null)
                trapIdx++;
        }

        // select the given trap
        const trapDiv = document.querySelector('.' + trapPrefix + trapIdx);
        const event = new MouseEvent('click');
        trapDiv.dispatchEvent(event);
    });
});

/**
 * Shows or hides explicit performance traps.
 *
 * @param {Event} event change event
 */
function toggleTraps(event) {
    const divWith = document.getElementById('codeWithTraps');
    const divWithout = document.getElementById('codeWithoutTraps');

    if (event.currentTarget.checked) {
        divWith.style.display = 'initial';
        divWithout.style.display = 'none';

        const codeWith = divWith.querySelector('code');
        Plotly.update('heatmap', {
            x: [heatmapValues.x],
            y: [heatmapValues.y],
            z: [heatmapValues.z]
        }, {
            'yaxis.type': 'category',
            height: codeWith.clientHeight + 6
        });
        return;
    }

    divWith.style.display = 'none';
    divWithout.style.display = 'initial';

    Plotly.update('heatmap', {
        x: [heatmapValuesFiltered.x],
        y: [heatmapValuesFiltered.y],
        z: [heatmapValuesFiltered.z]
    }, {
        'yaxis.type': 'category',
        height: heatmapHeight
    });
}

/**
 * Highlights and selects the given trap.
 *
 * @param {String} trapName
 */
function selectTraps(trapName) {
    // update highlight of the selected trap
    document.querySelectorAll('.trap .trap_select').forEach(t => t.classList.remove('trap_select'));
    document.querySelectorAll('.' + trapName + ' .trap_contents').forEach(t => t.classList.add('trap_select'));
}

/*
 * CONSTANTS
 */

const filteredMeasurements = {
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1: [92148, 92118, 92445, 92331, 92041, 92008, null, 91515, 91413, 92135, 92134, 91993, 92040, 91804, 92401, 91970, 92030, 91835, 91925, 91932, 92136, 91633, 91378, 91949, 91995, 91905, 91846, 91622, 91916, 91656, 91329, 91481, 91970, 91367, 91689, 92038, 92050, 91671, 91717, 91720, 91791, 91390, 91873, 91723, 92009, 91769, 92025, 91857, 91590, 91764, 91811, 91754, 91777, 91816, 91528, 91779, 91817, 91862, 91792, 91954, 91488, 91381, 91293, 91706, 91772, 91960, 91860, 91530, 91747, 91821, 91810, 91783, 91845, 91817, 91802, 91733, 91675, 91589, 91288, 91785, 91932, 91694, 91910, 91563, 91540, 91639, 91298, 91655, 91651, 91638, 91612, 91741, 91524, 91346, 92130, 91571, 91757, 91642, 91799, 91754],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2: [110, 455, 152, 186, 567, 749, -170, 100, 306, 301, 132, -23, 129, 488, 683, 137, 176, 428, 305, 288, 55, 280, 253, -15, 167, 288, 324, 333, 192, 522, 271, 374, -365, 228, -142, -203, 17, 371, -59, 301, -41, 467, 216, 554, -118, 220, -3, 209, 57, 312, 684, 364, 305, 66, 511, 220, 161, 80, 46, -293, 575, 392, 366, 281, 332, 475, 173, 495, 281, 808, -53, 367, -230, 285, 163, 159, -65, -17, 273, 107, 323, -25, 428, 577, 584, 587, 301, 90, 296, -75, 899, 123, 409, 599, -36, 266, 341, 458, 324, 275],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3: [429, -92, -681, 77, 393, -254, -58, 133, 684, -18, -211, 385, 360, 129, -665, 309, 70, -9, -214, -124, -102, 135, 233, 568, 43, 445, 436, -241, 19, -162, 165, 178, 296, 345, 168, -91, -66, 125, -20, 302, 295, 563, 200, -107, 122, 412, 0, -191, 257, 362, -376, -292, 124, 188, 40, 105, -7, -9, -156, 402, 143, 2, 54, 354, -164, -748, 195, 184, 266, -361, 388, -67, 764, 56, -53, 197, 385, 550, 101, -48, -74, 322, -296, -33, -296, 350, 65, 476, 64, 550, -370, 564, 54, 334, 233, 353, 102, 396, -50, -11],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4: [14, 278, 826, 192, null, 335, 253, 42, -100, 63, 813, -234, -48, -106, 34, -116, 260, 180, 32, 366, 259, 216, 17, -311, 277, -178, -489, 84, 226, 304, 337, -10, 120, -124, 170, 158, 278, -256, 583, -48, 205, -23, -88, -147, 28, 96, 3, 355, 332, -209, 64, 531, -9, -324, 297, 117, 128, 471, 17, 518, 26, 70, -6, -278, 152, 708, 25, 260, 2, 0, 198, 297, -93, 299, 635, 92, 731, 248, 102, 333, -39, -23, 102, 167, 52, -320, 95, -139, 144, -171, 106, -381, 252, -114, 184, -27, -156, -93, 351, 319],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5: [11, null, -404, 35, 430, -94, -305, 351, -36, 52, -367, 603, 375, 325, 283, 342, -242, 1, 423, -459, 159, 43, 77, 339, 389, -122, 616, 185, 158, 305, 41, -83, 326, 344, 105, -35, -371, 365, -165, 187, -134, -167, 3, 264, 343, -90, 378, -304, -42, 165, 72, -173, 150, 183, 34, 138, 250, -118, 362, -30, 182, 74, 204, 58, 514, -61, 1, -71, 147, 123, 70, 123, -214, 0, 60, 233, -160, 295, 36, 44, 23, 229, 206, 89, 239, 78, 308, 305, 159, 392, -35, 80, -17, 138, -257, 325, 259, -13, -303, -137],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6: [null, 156, 561, 270, 318, 305, 519, -124, 493, 168, 40, 44, -206, -24, 189, -7, -135, -55, 180, 601, 223, 293, -12, -115, -429, 323, -263, 521, -67, -18, -78, 504, 174, -49, 69, 143, 93, 82, -32, 37, 203, 215, 134, 289, 213, -90, 107, 406, 72, 142, 225, 42, -65, 22, -4, 233, 94, -198, 331, 188, -57, 90, 133, 323, -16, 247, 161, 101, -11, -66, 129, 107, 212, -98, -210, -5, -210, -74, 166, 283, 200, 169, -178, 123, -39, -250, -43, -242, -112, -41, 458, 234, -216, 275, 146, 154, 277, -205, 384, 289],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7: [null, 10047, 9691, 9708, 10149, 9559, 10303, 10226, 10107, 9991, 10502, 9707, 10229, 10174, 9962, 10483, 10494, 10506, 9839, 10069, 9999, 9685, 10266, 10740, 10282, 9962, 10274, 10067, 10229, 10144, 10156, 10092, 10401, 10183, 9970, 10303, 10095, 10260, 10226, 9820, 10380, 9971, 10262, 9961, 9968, 10423, 10209, 10343, 10128, 10163, 10033, 9874, 10375, 10200, 9931, 9941, 10164, 10525, 10209, 9834, 10157, 10170, 10465, 10183, 9943, 10246, 10781, 10128, 10246, 10266, 9828, 10014, 10409, 9987, 9879, 9725, 10280, 9882, 10056, 10248, 10245, 9885, 10403, 9944, 10290, 9981, 10257, 10386, 10109, 9841, 9909, 9951, 10751, 10159, 10338, 9725, 9951, 10414, 10168, 10135],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8: [3947622, 8150691, 4086361, 4299643, 6048692, 5942925, 4543790, 4768932, 8374429, 4651736, 2549676, 5121110, 9782905, 7328961, 5483418, 8395288, 8726867, 4544296, 342124, 3392440, 3029814, 1749234, 5930894, 3135654, 10026353, 2207986, 2570463, 9546525, 2431918, 810463, 2688189, 4064028, 10015374, 8149682, 5227229, 5578855, 5354943, 5461250, 10122966, 1739327, 3498592, 8608449, 9557305, 6879946, 5824012, 4064376, 6400283, 10016333, 3029824, 9195589, 3371085, 1621963, 1034849, 6646169, 7094495, 8502150, 938768, 128196, 4661862, 9675774, 5835272, 1269647, 4896519, 6517799, 6634973, 5226915, 2197185, 2794844, 2570851, 3851004, 1525706, 1973671, 3274856, 9302814, 1643024, 9185852, 5461678, 4202730, 2667277, 9419475, 6880738, 8864750, 5355417, 6518063, 1056320, 9302543, 6176628, 7584103, 245168, 8864977, 7094231, 4651481, 4416271, 9205740, 3840769, 7916269, 1152504, 6859612, 9782828, 1749643]
};

const movingAverages = {
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_1: [92148.0, 92133.0, 92237.0, 92260.5, 92216.6, 92181.83333333333, 92247.28571428571, 92155.75, 92073.22222222222, 92079.4, 92078.0, 92065.5, 92025.0, 91972.3, 92008.3, 92004.5, 91943.5, 91975.5, 92026.7, 92006.4, 92006.6, 91970.6, 91904.4, 91918.9, 91878.3, 91871.8, 91853.4, 91832.1, 91831.2, 91803.6, 91722.9, 91707.7, 91766.9, 91708.7, 91678.1, 91691.4, 91711.8, 91716.7, 91696.8, 91703.2, 91749.4, 91740.3, 91730.6, 91766.2, 91798.2, 91771.3, 91768.8, 91787.4, 91774.7, 91779.1, 91781.1, 91817.5, 91807.9, 91817.2, 91769.1, 91770.1, 91749.3, 91749.8, 91770.0, 91789.0, 91756.7, 91719.4, 91671.0, 91660.0, 91684.4, 91702.5, 91706.8, 91673.6, 91669.1, 91655.8, 91688.0, 91728.2, 91783.4, 91794.5, 91797.5, 91774.8, 91756.3, 91762.2, 91716.3, 91712.7, 91724.9, 91716.0, 91722.5, 91697.1, 91670.9, 91661.5, 91623.8, 91630.4, 91666.7, 91652.0, 91620.0, 91624.7, 91586.1, 91564.4, 91623.4, 91616.6, 91662.5, 91661.2, 91676.0, 91687.6],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_2: [110.0, 282.5, 239.0, 225.75, 294.0, 369.8333333333333, 292.7142857142857, 268.625, 272.77777777777777, 275.6, 277.8, 230.0, 227.7, 257.9, 269.5, 208.29999999999998, 242.9, 275.7, 275.6, 274.3, 266.6, 296.9, 309.3, 259.0, 207.4, 222.5, 237.3, 227.8, 216.5, 239.9, 261.5, 270.9, 209.1, 233.4, 202.5, 153.4, 122.69999999999999, 126.5, 101.40000000000002, 79.29999999999998, 48.1, 57.40000000000002, 115.5, 148.09999999999997, 150.5, 192.8, 190.8, 174.6, 186.2, 187.3, 259.8, 249.5, 258.4, 209.59999999999997, 272.5, 272.5, 288.9, 276.0, 274.9, 214.40000000000003, 203.5, 206.3, 212.4, 233.9, 216.0, 241.5, 242.7, 284.2, 307.7, 417.8, 355.0, 352.5, 292.9, 293.3, 276.4, 244.8, 221.0, 169.8, 169.0, 98.9, 136.5, 97.3, 163.1, 192.3, 234.40000000000003, 277.2, 313.8, 324.5, 326.8, 308.6, 366.2, 381.0, 379.1, 381.3, 319.3, 287.2, 291.2, 328.0, 330.8, 365.8],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_3: [429.0, 168.5, -114.66666666666671, -66.75, 25.2, -21.333333333333336, -26.571428571428584, -6.625, 70.11111111111114, 61.30000000000002, -2.6999999999999833, 45.0, 149.1, 154.3, 48.5, 104.8, 117.59999999999998, 103.40000000000002, 13.599999999999996, 3.0, 13.900000000000015, -11.099999999999989, -23.8, 20.09999999999998, 90.90000000000002, 104.5, 141.09999999999997, 117.90000000000003, 141.20000000000002, 137.4, 164.1, 168.40000000000003, 174.7, 152.40000000000003, 164.90000000000003, 111.29999999999998, 61.09999999999999, 97.70000000000002, 93.79999999999998, 140.2, 153.2, 191.70000000000002, 182.1, 136.9, 132.3, 182.6, 189.2, 157.6, 185.3, 191.3, 124.2, 38.70000000000002, 31.099999999999994, 60.59999999999999, 52.400000000000006, 21.700000000000006, 21.0, 39.20000000000001, -2.0999999999999974, 1.9000000000000112, 53.79999999999999, 83.2, 76.2, 92.8, 72.4, -12.900000000000011, 7.2999999999999945, 26.599999999999984, 68.8, -7.5, 17.0, 10.099999999999985, 81.09999999999997, 51.30000000000004, 62.40000000000001, 156.9, 175.9, 212.5, 196.0, 227.3, 181.1, 220.0, 114.0, 105.09999999999998, 80.8, 96.09999999999998, 64.09999999999998, 56.70000000000001, 53.0, 112.8, 83.20000000000002, 107.40000000000003, 142.40000000000003, 179.09999999999997, 232.0, 232.3, 236.0, 228.0, 216.6, 160.5],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_4: [14.0, 146.0, 372.6666666666667, 327.5, 115.6, 152.16666666666669, 166.57142857142858, 151.0, 123.11111111111113, 117.1, 197.0, 145.8, 58.400000000000006, 28.599999999999994, 105.2, 60.1, 60.79999999999998, 74.6, 87.8, 118.1, 62.7, 107.7, 114.20000000000002, 93.7, 118.0, 111.8, 36.90000000000001, 27.3, 46.70000000000001, 40.5, 48.30000000000001, 25.699999999999992, 36.0, 54.7, 44.0, 77.6, 154.3, 120.29999999999998, 156.0, 120.79999999999998, 107.6, 106.29999999999998, 85.5, 83.2, 69.0, 62.8, 35.3, 96.40000000000002, 71.3, 55.20000000000002, 41.099999999999994, 96.5, 104.4, 86.7, 113.6, 115.70000000000002, 128.2, 139.8, 108.29999999999998, 181.0, 177.2, 131.09999999999997, 131.40000000000003, 136.0, 121.5, 180.6, 170.3, 149.2, 147.7, 95.9, 113.1, 135.8, 127.1, 184.8, 233.1, 171.5, 242.1, 240.9, 250.9, 284.2, 260.5, 228.5, 248.0, 234.8, 176.5, 135.30000000000004, 71.70000000000002, 33.0, 37.20000000000001, -13.200000000000008, 1.2999999999999972, -34.5, -19.5, -47.6, -34.400000000000006, -5.099999999999996, -30.200000000000006, -25.6, -4.9, 44.09999999999999],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_5: [11.0, -349.0, -367.3333333333333, -266.75, -127.40000000000003, -121.83333333333334, -148.0, -85.625, -80.11111111111113, -66.90000000000002, -104.69999999999999, 26.5, 104.40000000000002, 133.4, 118.7, 162.3, 168.6, 133.6, 179.5, 128.4, 181.0, 125.0, 95.20000000000002, 96.6, 107.2, 60.79999999999998, 146.59999999999997, 165.0, 138.5, 214.9, 203.1, 190.5, 215.4, 215.9, 187.5, 196.2, 97.5, 115.5, 83.2, 71.4, 53.90000000000001, 45.5, 13.20000000000001, 5.2000000000000055, 29.0, 23.5, 98.4, 31.5, 43.79999999999999, 41.599999999999994, 62.20000000000001, 61.6, 76.3, 68.2, 37.29999999999999, 60.1, 47.29999999999999, 65.9, 106.3, 86.8, 97.79999999999998, 122.5, 127.9, 115.4, 163.4, 143.5, 118.6, 123.3, 101.8, 117.1, 105.9, 110.8, 69.0, 63.20000000000001, 17.800000000000004, 47.2, 31.100000000000005, 67.7, 56.6, 48.7, 44.0, 54.6, 96.6, 105.5, 123.4, 107.9, 154.7, 155.7, 168.0, 202.8, 197.0, 182.1, 159.8, 164.7, 115.09999999999998, 139.8, 134.9, 103.1, 56.90000000000001, 4.0],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_6: [823.0, 489.5, 513.3333333333334, 452.5, 425.6, 405.5, 421.7142857142857, 353.5, 369.0, 348.9, 270.6, 259.4, 182.7, 153.3, 140.40000000000003, 109.2, 43.79999999999998, 50.7, 19.39999999999999, 62.69999999999999, 81.0, 105.90000000000002, 125.3, 116.2, 54.40000000000001, 87.40000000000002, 74.59999999999998, 132.2, 107.5, 45.599999999999994, 15.5, 36.59999999999999, 55.20000000000001, 61.79999999999998, 111.6, 93.6, 129.2, 85.3, 88.8, 94.29999999999998, 122.4, 93.5, 89.5, 123.3, 137.7, 114.4, 115.8, 148.2, 158.6, 169.1, 171.3, 154.0, 134.1, 107.4, 85.70000000000002, 118.0, 116.7, 56.3, 82.2, 86.8, 58.6, 63.400000000000006, 83.2, 113.3, 112.1, 113.5, 120.20000000000002, 150.1, 115.9, 90.5, 109.10000000000001, 110.79999999999998, 118.70000000000002, 76.6, 57.20000000000002, 32.0, -5.099999999999997, -22.6, -4.899999999999998, 30.0, 37.10000000000001, 43.300000000000004, 4.2999999999999945, 26.4, 43.5, 19.0, 35.70000000000001, 18.90000000000002, -8.900000000000018, -41.29999999999999, -15.5, -9.0, -12.799999999999995, 2.4000000000000057, 20.90000000000001, 61.29999999999999, 93.29999999999998, 97.0, 146.6, 179.6],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_7: [9338.0, 9692.5, 9692.0, 9696.0, 9786.6, 9748.666666666666, 9827.857142857143, 9877.625, 9903.111111111111, 9911.9, 10028.3, 9994.3, 10048.1, 10094.7, 10076.0, 10168.4, 10187.5, 10215.5, 10188.7, 10196.5, 10146.2, 10144.0, 10147.7, 10204.3, 10236.3, 10184.2, 10162.2, 10118.3, 10157.3, 10164.8, 10180.5, 10221.2, 10234.7, 10179.0, 10147.8, 10181.9, 10164.0, 10183.3, 10183.0, 10150.6, 10173.0, 10160.9, 10147.0, 10124.8, 10124.6, 10136.6, 10148.0, 10156.3, 10146.5, 10180.8, 10146.1, 10136.4, 10147.7, 10171.6, 10167.9, 10119.7, 10115.2, 10133.4, 10141.5, 10108.6, 10121.0, 10150.6, 10159.6, 10157.9, 10159.1, 10189.6, 10251.3, 10211.6, 10215.3, 10258.5, 10225.6, 10210.0, 10204.4, 10184.8, 10178.4, 10126.3, 10076.2, 10051.6, 10032.6, 10030.8, 10072.5, 10059.6, 10059.0, 10054.7, 10095.8, 10121.4, 10119.1, 10169.5, 10174.8, 10134.1, 10100.5, 10107.1, 10141.9, 10163.4, 10168.2, 10142.6, 10112.0, 10114.8, 10120.7, 10150.1],
    TRAP_example_Example_hash_example_argb_javacard_framework_APDU_arge_8: [3947622.0, 6049156.5, 5394891.333333333, 5121079.25, 5306601.8, 5412655.666666667, 5288532.0, 5223582.0, 5573676.111111111, 5481482.1, 5341687.5, 5038729.4, 5608383.8, 5911315.6, 5854788.2, 6100024.5, 6518332.2, 6495868.6, 5692638.1, 5566708.5, 5614722.3, 5277534.7, 4892333.6, 4473002.9, 4927296.4, 4308566.2, 3692925.8, 4193148.7, 4402128.1, 4143930.4, 4109767.9, 4341247.3, 4749695.3, 5251098.1, 4771185.7, 5108272.6, 5386720.6, 4978193.1, 5747297.9, 5840184.3, 5921224.6, 6375666.7, 6329859.8, 6202886.2, 6262564.5, 6111116.6, 6215650.6, 6671158.9, 5961844.7, 6707470.9, 6694720.2, 5996071.6, 5143826.0, 5120448.3, 5247496.6, 5691274.0, 5145122.5, 4156308.8, 4319512.6, 4367531.1, 4613949.8, 4578718.2, 4964885.2, 4952048.2, 4906096.0, 4578572.5, 4704414.2, 4971079.0, 4761977.9, 4179500.9, 3748544.3, 3818946.7, 3656780.4, 3935281.9, 3436087.0, 3831980.6999999997, 4158430.0, 4299218.6, 4308861.2, 4865708.3, 5401211.5, 6090319.4, 6298375.5, 6019900.4, 5961230.0, 5972899.1, 6044394.1, 6382531.4, 6140320.5, 6084870.7, 6106220.0, 5684893.1, 5590978.5, 5859746.2, 6138191.1, 5999563.7, 5497151.3, 5424702.2, 6378468.2, 5666934.8]
};

const scatterCommon = {
    type: 'scatter',
    xaxis: 'x3',
    yaxis: 'y2',
    name: 'elapsed time',
    showlegend: true,
    marker: {
        color: 'rgb(225, 148, 22)'
    },
    hovertemplate: 'Trace: elapsed time<br>Round: %{x}<br>Time: %{y} μs<extra></extra>'
};

const layoutCommon = {
    bargap: 0.2,
    barmode: 'overlay',
    height: 700,
    margin: {
        l: 60,
        r: 40,
        b: 40,
        t: 40,
        pad: 5
    },
    xaxis1: {
        anchor: 'y1',
        title: 'Unreachable'
    },
    xaxis2: {
        anchor: 'y1',
        // dtick: 1,
        tickformat: ',d',
        title: 'Time in μs'
    },
    xaxis3: {
        anchor: 'y2',
        domain: [0, 1],
        tickformat: ',d',
        title: 'Round'
    },
    yaxis1: {
        anchor: 'x1',
        domain: [0.55, 1],
        title: 'Frequency'
        // type: 'log',
    },
    yaxis2: {
        anchor: 'x3',
        domain: [0, 0.43],
        title: 'Time in μs'
    }
};

/*
 * FUNCTIONS
 */

// set default heading
document.getElementById('graphName').innerText = 'Select a line to view its histogram.';

/**
 * Redraw graph event handler
 *
 * @param {Event} evt mouse click event
 */
function redrawGraph(evt) {
    // enable graph help
    document.getElementById('graphHelp').style.display = 'initial';

    // attribute with trap name is always the first
    const trapName = evt.currentTarget.classList[0];

    // update highlight of the selected trap
    selectTraps(trapName);

    // update trap title
    document.getElementById('graphName').textContent = trapName;

    const filteredVals = filteredMeasurements[trapName];
    const movingAverage = movingAverages[trapName];
    const vals = measurements[trapName];

    const traces = [];

    const hasTime = vals.some(e => e !== null);
    if (hasTime) {
        // Histograms
        traces.push({
            ...histogramCommon,
            x: filteredVals,
            name: 'measurements',
            meta: ['measurements'],
            marker: {
                color: 'rgb(49, 130, 189)',
                opacity: 0.75
            }
        });

        traces.push({
            ...histogramCommon,
            x: vals.map((e, i) => filteredVals[i] !== null ? null : e),
            name: 'outliers',
            meta: ['outliers'],
            visible: 'legendonly',
            marker: {
                color: 'rgb(255, 136, 0)',
                opacity: 0.75
            }
        });

        // Line graph

        // make dots only on line endings
        const dot_x = [], dot_y = [];
        for (let i = 0; i < vals.length; i++) {
            // no value
            if (vals[i] === null)
                continue;

            // both neighbouring values are defined or only one is defined on border values
            if (vals.length > 1 &&
                (i === 0 || vals[i - 1] !== null) && (i === vals.length - 1 || vals[i + 1] != null))
                continue;

            dot_x.push(i + 1);
            dot_y.push(vals[i]);
        }

        traces.push({
            ...scatterCommon,
            x: dot_x,
            y: dot_y,
            mode: 'markers',
            showlegend: false
        }, {
            ...scatterCommon,
            x: [...Array(vals.length + 1).keys()].splice(1),
            y: vals,
            mode: 'lines'
        }, {
            ...scatterCommon,
            x: [...Array(vals.length + 1).keys()].splice(1),
            y: movingAverage,
            name: 'moving average',
            marker: {
                color: 'rgb(166, 56, 64)'
            },
            hovertemplate: 'Trace: moving average<br>Round: %{x}<br>Average time: %{y} μs<extra></extra>'
        });
    }

    // bar graph visualising number of unreachable rounds
    const hasUnreach = vals.includes(null);
    if (hasUnreach) {
        const y = vals.filter(e => e === null).length;
        traces.push({
            x: [''],
            y: [y],
            type: 'bar',
            xaxis: 'x1',
            yaxis: 'y1',
            name: 'unreachable',
            showlegend: false,
            marker: {
                color: 'rgb(255, 0, 0)',
                opacity: 0.65
            },
            hovertemplate: 'Unreachable<br>Count: %{y} (%{y}/' + vals.length + ')<extra></extra>'
        });
    }

    // WARNING: Layout and config must be passed directly!  Otherwise, sometimes the graph may fail to load.
    Plotly.react('plotly', traces, {
        ...layoutCommon,
        xaxis1: {
            ...layoutCommon.xaxis1,
            domain: [0, hasTime ? 0.45 : 1]
        },
        xaxis2: {
            ...layoutCommon.xaxis2,
            domain: [hasUnreach ? 0.55 : 0, 1]
        }
    }, {...configCommon});

    // set click event handler
    const plotlyDiv = document.getElementById('plotly');

    // get bin half of the bin size
    // Unfortunately, the xbins.size key is stored only in the first histogram trace and not in the rest, so we have
    // to obtain this value in advance.
    const binSizeHalf = plotlyDiv._fullData[0].xbins.size / 2;

    // replace the event handler
    plotlyDiv.removeAllListeners('plotly_click');
    plotlyDiv.on('plotly_click', function (data) {
        const graph = data.points[0];
        let msg = '', selectedInputs;

        switch (graph.data.type) {
            // line graph
            case 'scatter':
                selectedInputs = [inputs[graph.x - 1]];
                msg = 'Round: ' + graph.x + '\n';
                break;
            case 'histogram':
                selectedInputs = graph.pointIndices.map(
                    e => inputs[ e]);

                msg += 'Bin: ' + Math.ceil(graph.x - binSizeHalf) + ' to ' + Math.floor(graph.x + binSizeHalf) + '\n';
                break;
            case 'bar':
                selectedInputs = vals.reduce((res, e, i) => {
                    if (e === null)
                        res.push(inputs[i]);
                    return res;
                }, []);
                console.assert(selectedInputs.length === graph.y);

                msg = 'Unreachable\n';
                break;
            default:
                return;
        }

        msg += 'Inputs:\n';

        const sortedInputs = Array.from(new Set(selectedInputs)).sort();
        sortedInputs.forEach(e => msg += '00EE0000' + e + '\n');

        alert(msg);
    });
}

// Set-up event listeners
window.addEventListener('load', _ => {
    document.getElementById('trapSwitch').addEventListener('change', toggleTraps);
    document.querySelectorAll('.trap').forEach(elem => elem.addEventListener('click', evt => redrawGraph(evt)));
});
    </script>
</body>
</html>
